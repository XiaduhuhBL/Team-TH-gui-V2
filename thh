-- T00kshaf1y's F3X GUI v2 - FIXED DRAG AND MUSIC
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- 删除旧GUI
if PlayerGui:FindFirstChild("T00kshaf1yGUI") then
    PlayerGui.T00kshaf1yGUI:Destroy()
end

-- 创建GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "T00kshaf1yGUI"
ScreenGui.Parent = PlayerGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

-- 主框架
local MainFrame = Instance.new("Frame")
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
MainFrame.BorderColor3 = Color3.fromRGB(0, 255, 255)
MainFrame.BorderSizePixel = 2
MainFrame.Position = UDim2.new(0.3, 0, 0.1, 0)
MainFrame.Size = UDim2.new(0, 500, 0, 600)
MainFrame.Active = true
MainFrame.Draggable = true  -- 启用拖动

-- 简单的拖动功能
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(
        startPos.X.Scale, 
        startPos.X.Offset + delta.X,
        startPos.Y.Scale, 
        startPos.Y.Offset + delta.Y
    )
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- 滚动框架
local ScrollingFrame = Instance.new("ScrollingFrame")
ScrollingFrame.Parent = MainFrame
ScrollingFrame.Size = UDim2.new(1, 0, 1, 0)
ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 3000)
ScrollingFrame.ScrollBarThickness = 12
ScrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(0, 255, 255)
ScrollingFrame.ScrollingDirection = Enum.ScrollingDirection.Y

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = ScrollingFrame
UIListLayout.Padding = UDim.new(0, 5)

-- 标题
local Title = Instance.new("TextLabel")
Title.Parent = ScrollingFrame
Title.Size = UDim2.new(0, 480, 0, 50)
Title.BackgroundTransparency = 1
Title.Text = "T00kshaf1y's F3X GUI v2 - DRAG ME"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 24
Title.LayoutOrder = 1

-- 按钮创建
local function CreateButton(text, layoutOrder)
	local button = Instance.new("TextButton")
	button.Parent = ScrollingFrame
	button.Size = UDim2.new(0, 480, 0, 40)
	button.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	button.BorderColor3 = Color3.fromRGB(255, 0, 0)
	button.Text = text
	button.TextColor3 = Color3.fromRGB(255, 255, 255)
	button.TextSize = 16
	button.LayoutOrder = layoutOrder
	return button
end

-- 创建所有按钮
local buttons = {
    -- 工具
    {text = "Get Btools", order = 2},
    
    -- 天空盒
    {text = "Skybox 1", order = 3},
    {text = "Skybox 2", order = 4},
    {text = "Islam Skybox", order = 5},
    
    -- 贴图
    {text = "Decal Spam 1", order = 6},
    {text = "Decal Spam 2", order = 7},
    {text = "Islam Decal Spam", order = 8},
    
    -- 消息系统
    {text = "Send Message 1", order = 9},
    {text = "Send Message 2", order = 10},
    
    -- 4个Hint按钮
    {text = "Hint Message 1", order = 11},
    {text = "Hint Message 2", order = 12},
    {text = "Hint Message 3", order = 13},
    {text = "Hint Message 4", order = 14},
    
    -- 警报
    {text = "Alert Message 1", order = 15},
    {text = "Alert Message 2", order = 16},
    
    -- 特效
    {text = "Fire All Parts", order = 17},
    {text = "Disco Lights", order = 18},
    {text = "Fog Effect", order = 19},
    
    -- 玩家控制
    {text = "Title Me", order = 20},
    {text = "Title Others", order = 21},
    {text = "Invisible All", order = 22},
    {text = "Freeze All", order = 23},
    {text = "Jail All", order = 24},
    {text = "Kill All", order = 25},
    {text = "Ice All", order = 26},
    
    -- 地图控制
    {text = "Unanchor All", order = 27},
    {text = "Destroy All", order = 28},
    {text = "Random Color Spam", order = 29},
    {text = "Create Baseplate", order = 30},
    
    -- 时间
    {text = "Set Night", order = 31},
    {text = "Set Day", order = 32},
    
    -- 传送
    {text = "Bring All Players", order = 33},
    {text = "TP All to Meep City", order = 34},
    
    -- 反作弊
    {text = "Anti Skid", order = 35},
    
    -- 车辆
    {text = "Car All Players", order = 36},
    {text = "Tank All Players", order = 37},
    {text = "Fling All Players", order = 38},
    
    -- 踢人
    {text = "Kick All Players", order = 39},
    {text = "Punish All Players", order = 40},
    
    -- 团队
    {text = "Create Team Spam", order = 41},
    {text = "Team Name All", order = 42},
    
    -- 角色
    {text = "Become T00kshaf1y", order = 43},
    {text = "Become c00lkidd", order = 44},
    {text = "Become Tubers93", order = 45},
    
    -- 保存
    {text = "Save Map", order = 46},
    
    -- Realm
    {text = "CREATE REALM", order = 47},
}

local ButtonInstances = {}
for i, btn in ipairs(buttons) do
    ButtonInstances[i] = CreateButton(btn.text, btn.order)
end

-- 音乐区
local MusicTitle = Instance.new("TextLabel")
MusicTitle.Parent = ScrollingFrame
MusicTitle.Size = UDim2.new(0, 480, 0, 40)
MusicTitle.BackgroundTransparency = 1
MusicTitle.Text = "🎵 MUSIC SECTION 🎵"
MusicTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
MusicTitle.TextSize = 20
MusicTitle.LayoutOrder = 50

-- 音乐按钮
local musicButtons = {
    {text = "IDK Music", order = 51},
    {text = "Ba Fang Lai Cai", order = 52},
    {text = "Team's Theme", order = 53},
    {text = "c00lkidd Theme", order = 54},
    {text = "Jumpstyle", order = 55},
    {text = "Funk", order = 56},
    {text = "Wind of the Flords", order = 57},
    {text = "Whistle", order = 58},
    {text = "IDK 2", order = 59},
    {text = "Sparta Remix", order = 60},
}

for i, music in ipairs(musicButtons) do
    ButtonInstances[50 + i] = CreateButton(music.text, music.order)
end

-- HD Admin功能 - 修复版本
local function HDAdminCommand(command)
    local success, result = pcall(function()
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        
        -- 检查HD Admin是否存在
        local HDAdminClient = ReplicatedStorage:FindFirstChild("HDAdminClient") or 
                             ReplicatedStorage:FindFirstChild("HDAdminHDClient")
        
        if HDAdminClient then
            local Signals = HDAdminClient:FindFirstChild("Signals")
            if Signals then
                local RequestCommand = Signals:FindFirstChild("RequestCommand") or 
                                      Signals:FindFirstChild("RequestCommandSilent")
                if RequestCommand then
                    RequestCommand:InvokeServer(command)
                    print("✅ Command executed: " .. command)
                    return true
                end
            end
        end
        
        -- 如果HD Admin不存在，尝试其他方法
        local ChatService = game:GetService("Chat")
        local SayMessageRequest = ChatService:FindFirstChild("SayMessageRequest")
        if SayMessageRequest then
            if command:sub(1,1) == ";" then
                SayMessageRequest:FireServer(command:sub(2), "All")
                print("✅ Chat command: " .. command)
                return true
            end
        end
        
        warn("❌ HD Admin not found or command failed: " .. command)
        return false
    end)
    
    if not success then
        warn("❌ Error executing command: " .. command)
        warn("Error: " .. tostring(result))
    end
    
    return success
end

-- 连接按钮功能
ButtonInstances[2].MouseButton1Click:Connect(function() HDAdminCommand(";btools me") end)

-- 4个Hint按钮
ButtonInstances[11].MouseButton1Click:Connect(function() HDAdminCommand(";h Join our team now!") end)
ButtonInstances[12].MouseButton1Click:Connect(function() HDAdminCommand(";h T00kshaf1y is here!") end)
ButtonInstances[13].MouseButton1Click:Connect(function() HDAdminCommand(";h Hacked by us!") end)
ButtonInstances[14].MouseButton1Click:Connect(function() HDAdminCommand(";h Team t00kshaf1y on top!") end)

-- 消息按钮
ButtonInstances[9].MouseButton1Click:Connect(function() HDAdminCommand(";sm Team t00kshaf1y join today!!") end)
ButtonInstances[10].MouseButton1Click:Connect(function() HDAdminCommand(";sm T00kshaf1y has hacked this server!") end)

-- 警报按钮
ButtonInstances[15].MouseButton1Click:Connect(function() HDAdminCommand(";alert all HACKED BY T00KSHAF1Y") end)
ButtonInstances[16].MouseButton1Click:Connect(function() HDAdminCommand(";alert all Welcome to Team t00kshaf1y!") end)

-- 玩家控制
ButtonInstances[20].MouseButton1Click:Connect(function() HDAdminCommand(";titleb me T00kshaf1y") end)
ButtonInstances[21].MouseButton1Click:Connect(function() HDAdminCommand(";title all Team t00kshaf1y") end)
ButtonInstances[22].MouseButton1Click:Connect(function() HDAdminCommand(";invisible all") end)
ButtonInstances[23].MouseButton1Click:Connect(function() HDAdminCommand(";freeze all") end)
ButtonInstances[24].MouseButton1Click:Connect(function() HDAdminCommand(";jail all") end)
ButtonInstances[25].MouseButton1Click:Connect(function() HDAdminCommand(";kill all") end)
ButtonInstances[26].MouseButton1Click:Connect(function() HDAdminCommand(";ice all") end)

-- 特效
ButtonInstances[17].MouseButton1Click:Connect(function() HDAdminCommand(";fire all") end)
ButtonInstances[18].MouseButton1Click:Connect(function() HDAdminCommand(";disco") end)
ButtonInstances[19].MouseButton1Click:Connect(function() HDAdminCommand(";fog") end)

-- 地图控制
ButtonInstances[27].MouseButton1Click:Connect(function() HDAdminCommand(";unanchor all") end)
ButtonInstances[28].MouseButton1Click:Connect(function() HDAdminCommand(";destroy all") end)
ButtonInstances[29].MouseButton1Click:Connect(function() HDAdminCommand(";randomcolor all") end)

-- 时间
ButtonInstances[31].MouseButton1Click:Connect(function() HDAdminCommand(";time 23") end)
ButtonInstances[32].MouseButton1Click:Connect(function() HDAdminCommand(";time 14") end)

-- 传送
ButtonInstances[33].MouseButton1Click:Connect(function() HDAdminCommand(";bring all") end)
ButtonInstances[34].MouseButton1Click:Connect(function() HDAdminCommand(";forceplace all 109147333821356") end)

-- 反作弊
ButtonInstances[35].MouseButton1Click:Connect(function() 
    HDAdminCommand(";hideguis others")
    HDAdminCommand(";uncmdbar2 others") 
    HDAdminCommand(";mute others")
end)

-- 车辆
ButtonInstances[36].MouseButton1Click:Connect(function() HDAdminCommand(";car all") end)
ButtonInstances[37].MouseButton1Click:Connect(function() HDAdminCommand(";tank all") end)
ButtonInstances[38].MouseButton1Click:Connect(function() HDAdminCommand(";fling all") end)

-- 踢人
ButtonInstances[39].MouseButton1Click:Connect(function() HDAdminCommand(";kick all") end)
ButtonInstances[40].MouseButton1Click:Connect(function() HDAdminCommand(";punish all") end)

-- 团队
ButtonInstances[41].MouseButton1Click:Connect(function() 
    HDAdminCommand(";createteam red T00kshaf1y")
    HDAdminCommand(";createteam blue T00kshaf1y")
    HDAdminCommand(";createteam green T00kshaf1y")
end)
ButtonInstances[42].MouseButton1Click:Connect(function() HDAdminCommand(";name all T00kshaf1y") end)

-- 角色
ButtonInstances[43].MouseButton1Click:Connect(function() 
    HDAdminCommand(";char me ttsghdvhfc2")
    HDAdminCommand(";name me t00kshaf1y")
end)
ButtonInstances[44].MouseButton1Click:Connect(function() 
    HDAdminCommand(";char me c00lkiddsb4k")
    HDAdminCommand(";name me c00lkidd")
end)
ButtonInstances[45].MouseButton1Click:Connect(function() 
    HDAdminCommand(";char me Tubers93qm")
    HDAdminCommand(";name me Tubers93")
end)

-- 保存
ButtonInstances[46].MouseButton1Click:Connect(function() HDAdminCommand(";savemap") end)

-- Realm
ButtonInstances[47].MouseButton1Click:Connect(function()
    HDAdminCommand(";btools me")
    HDAdminCommand(";sm Team t00kshaf1y join now!!")
    wait(0.5)
    HDAdminCommand(";fogcolor black")
    HDAdminCommand(";punish all")
    HDAdminCommand(";res all")
    HDAdminCommand(";r6 all")
    HDAdminCommand(";blur all")
    HDAdminCommand(";fog")
    HDAdminCommand(";disco")
    HDAdminCommand(";alert all Welcome to Team t00kshaf1y Realm!")
    HDAdminCommand(";fire all")
    HDAdminCommand(";dog all")
    HDAdminCommand(";title me t00kshaf1y")
    HDAdminCommand(";name all t00kshaf1y")
    HDAdminCommand(";time 23")
    HDAdminCommand(";music 1847661821 ;volume inf ;pitch 1.1")
    HDAdminCommand(";char all ttsghdvhfc2")
    HDAdminCommand(";freeze all")
    HDAdminCommand(";jail all")
    HDAdminCommand(";loopkill all")
end)

-- 音乐按钮 - 修复版本
ButtonInstances[51].MouseButton1Click:Connect(function() HDAdminCommand(";music 109312105079673") HDAdminCommand(";volume inf") end)
ButtonInstances[52].MouseButton1Click:Connect(function() HDAdminCommand(";music 113158802785741") HDAdminCommand(";pitch 0.1") HDAdminCommand(";volume inf") end)
ButtonInstances[53].MouseButton1Click:Connect(function() HDAdminCommand(";music 1847661821") HDAdminCommand(";pitch 0.9") HDAdminCommand(";volume inf") end)
ButtonInstances[54].MouseButton1Click:Connect(function() HDAdminCommand(";music 122552583844805") HDAdminCommand(";pitch 0.10") HDAdminCommand(";volume inf") end)
ButtonInstances[55].MouseButton1Click:Connect(function() HDAdminCommand(";music 1839246711") HDAdminCommand(";pitch 1.1") HDAdminCommand(";volume inf") end)
ButtonInstances[56].MouseButton1Click:Connect(function() HDAdminCommand(";music 16190783774") HDAdminCommand(";pitch 1.2") HDAdminCommand(";volume inf") end)
ButtonInstances[57].MouseButton1Click:Connect(function() HDAdminCommand(";music 93932484780481") HDAdminCommand(";pitch 0.09") HDAdminCommand(";volume inf") end)
ButtonInstances[58].MouseButton1Click:Connect(function() HDAdminCommand(";music 3152833592") HDAdminCommand(";volume inf") end)
ButtonInstances[59].MouseButton1Click:Connect(function() HDAdminCommand(";music 3892375615") HDAdminCommand(";pitch 1.0") HDAdminCommand(";volume inf") end)
ButtonInstances[60].MouseButton1Click:Connect(function() HDAdminCommand(";music 73293994328169") HDAdminCommand(";volume inf") HDAdminCommand(";pitch 0.1") end)
